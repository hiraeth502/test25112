<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬êµ¬ë‹¨ ì‚°ì„±ë¹„ ê²Œì„</title>
    <style>
        /* 1. ìŠ¤íƒ€ì¼(ë””ìì¸) ì„¤ì • */
        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            color: white;
            font-family: 'Malgun Gothic', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        h1 { margin-top: 20px; }

        /* ê²Œì„ í™”ë©´ ì˜ì—­ */
        #game-container {
            position: relative;
            width: 800px;
            height: 500px;
            background-color: #000;
            border: 4px solid #4CAF50;
            border-radius: 10px;
            overflow: hidden; /* ì˜ì—­ ë°–ìœ¼ë¡œ ë‚˜ê°„ ê¸€ì ìˆ¨ê¹€ */
            margin-bottom: 20px;
        }

        /* ë–¨ì–´ì§€ëŠ” ë¬¸ì œ(ë¹—ë°©ìš¸) ìŠ¤íƒ€ì¼ */
        .raindrop {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            white-space: nowrap;
        }

        /* ë°”ë‹¥ì— ë‹¿ëŠ” ê²½ê³„ì„  (ë¹¨ê°„ ì¤„) */
        #danger-line {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 5px;
            background-color: red;
            box-shadow: 0 0 10px red;
        }

        /* í•˜ë‹¨ ì…ë ¥ ë° ì •ë³´ì°½ */
        #ui-bar {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 24px;
        }

        input[type="number"] {
            padding: 10px;
            font-size: 24px;
            width: 150px;
            text-align: center;
            border-radius: 5px;
            border: none;
        }

        /* ê²Œì„ ì‹œì‘/ì¢…ë£Œ ì˜¤ë²„ë ˆì´ */
        #overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        button {
            padding: 15px 30px;
            font-size: 24px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover { background-color: #45a049; }

        .game-info { color: #aaa; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>ğŸŒ§ï¸ êµ¬êµ¬ë‹¨ ì‚°ì„±ë¹„ ê²Œì„ ğŸŒ§ï¸</h1>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="game-container">
        <div id="danger-line"></div>
        <!-- ì‹œì‘ í™”ë©´ ë ˆì´ì–´ -->
        <div id="overlay">
            <h2 id="msg-title">êµ¬êµ¬ë‹¨ ì—°ìŠµì„ ì‹œì‘í•´ë³¼ê¹Œìš”?</h2>
            <p class="game-info">ì •ë‹µì„ ì…ë ¥í•˜ê³  [Enter]ë¥¼ ëˆ„ë¥´ì„¸ìš”!</p>
            <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
        </div>
    </div>

    <!-- ì ìˆ˜ ë° ì…ë ¥ì°½ -->
    <div id="ui-bar">
        <span>ì ìˆ˜: <b id="score">0</b></span>
        <span>ìƒëª…: <b id="life" style="color:red">â¤â¤â¤</b></span>
        <input type="number" id="input-answer" placeholder="ì •ë‹µ ì…ë ¥" autofocus onkeydown="checkEnter(event)">
    </div>

    <script>
        /* 2. ìë°”ìŠ¤í¬ë¦½íŠ¸(ê²Œì„ ë¡œì§) ì„¤ì • */
        
        const gameContainer = document.getElementById('game-container');
        const inputField = document.getElementById('input-answer');
        const scoreEl = document.getElementById('score');
        const lifeEl = document.getElementById('life');
        const overlay = document.getElementById('overlay');
        const msgTitle = document.getElementById('msg-title');

        let score = 0;
        let lives = 3;
        let isPlaying = false;
        let rainInterval; // ë¬¸ì œ ìƒì„± íƒ€ì´ë¨¸
        let moveInterval; // ì›€ì§ì„ íƒ€ì´ë¨¸
        let raindrops = []; // í˜„ì¬ í™”ë©´ì— ìˆëŠ” ë¬¸ì œë“¤ ì €ì¥
        let dropSpeed = 2; // ë–¨ì–´ì§€ëŠ” ì†ë„ (ì¡°ì ˆ ê°€ëŠ¥)

        // ê²Œì„ ì‹œì‘ í•¨ìˆ˜
        function startGame() {
            // ì´ˆê¸°í™”
            score = 0;
            lives = 3;
            dropSpeed = 2;
            raindrops.forEach(drop => drop.element.remove()); // ê¸°ì¡´ ë¬¸ì œ ì œê±°
            raindrops = [];
            scoreEl.innerText = score;
            updateLifeUI();
            
            isPlaying = true;
            overlay.style.display = 'none'; // ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
            inputField.value = '';
            inputField.focus();

            // ë£¨í”„ ì‹œì‘
            rainInterval = setInterval(createProblem, 1000); // 1ì´ˆë§ˆë‹¤ ë¬¸ì œ ìƒì„±
            moveInterval = setInterval(moveRaindrops, 20); // 0.02ì´ˆë§ˆë‹¤ ì›€ì§ì„ ì—…ë°ì´íŠ¸
        }

        // êµ¬êµ¬ë‹¨ ë¬¸ì œ ìƒì„±
        function createProblem() {
            if (!isPlaying) return;

            const a = Math.floor(Math.random() * 8) + 2; // 2~9ë‹¨
            const b = Math.floor(Math.random() * 9) + 1; // 1~9
            const problemText = `${a} x ${b}`;
            const answer = a * b;

            // HTML ìš”ì†Œ ìƒì„±
            const dropEl = document.createElement('div');
            dropEl.classList.add('raindrop');
            dropEl.innerText = problemText;
            
            // ëœë¤ ìœ„ì¹˜ (í™”ë©´ ë„ˆë¹„ 800px ì•ˆì—ì„œ)
            const randomX = Math.floor(Math.random() * 700) + 10; 
            dropEl.style.left = randomX + 'px';
            dropEl.style.top = '0px';

            gameContainer.appendChild(dropEl);

            // ë°°ì—´ì— ë°ì´í„° ì €ì¥
            raindrops.push({
                element: dropEl,
                answer: answer,
                y: 0
            });
        }

        // ë¬¸ì œ ì´ë™ ë° ì¶©ëŒ ì²´í¬
        function moveRaindrops() {
            if (!isPlaying) return;

            // ëª¨ë“  ë¹—ë°©ìš¸ì„ ì•„ë˜ë¡œ ì´ë™
            for (let i = 0; i < raindrops.length; i++) {
                let drop = raindrops[i];
                drop.y += dropSpeed;
                drop.element.style.top = drop.y + 'px';

                // ë°”ë‹¥ì— ë‹¿ì•˜ì„ ë•Œ (ê²Œì„ ì˜¤ë²„ íŒì •)
                if (drop.y > 470) { 
                    removeDrop(i); // í™”ë©´ì—ì„œ ì œê±°
                    lives--; // ìƒëª… ê°ì†Œ
                    updateLifeUI();
                    i--; // ë°°ì—´ ì¸ë±ìŠ¤ ë³´ì •

                    if (lives <= 0) {
                        gameOver();
                    }
                }
            }
        }

        // ì •ë‹µ í™•ì¸ (ì—”í„°í‚¤ ëˆŒë €ì„ ë•Œ)
        function checkEnter(event) {
            if (event.key === 'Enter') {
                const userAnswer = parseInt(inputField.value);
                
                // í˜„ì¬ í™”ë©´ì— ìˆëŠ” ë¬¸ì œë“¤ ì¤‘ ì •ë‹µ ì°¾ê¸°
                // (ê°€ì¥ ì•„ë˜ì— ìˆëŠ” ë¬¸ì œë¶€í„° í™•ì¸í•˜ê¸° ìœ„í•´ ì—­ìˆœ íƒìƒ‰ë„ ì¢‹ìŒ, ì—¬ê¸°ì„  ì•ì—ì„œë¶€í„°)
                let matched = false;
                for (let i = 0; i < raindrops.length; i++) {
                    if (raindrops[i].answer === userAnswer) {
                        // ì •ë‹µ!
                        removeDrop(i);
                        score += 10;
                        scoreEl.innerText = score;
                        matched = true;
                        
                        // ì ìˆ˜ê°€ ì˜¤ë¥´ë©´ ì†ë„ ì¦ê°€ (ë‚œì´ë„ ì¡°ì ˆ)
                        if (score % 50 === 0) dropSpeed += 0.5;
                        
                        break; // í•œ ë²ˆì— í•˜ë‚˜ì”©ë§Œ ì œê±°
                    }
                }

                inputField.value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
            }
        }

        // ë¹—ë°©ìš¸ ì œê±° í•¨ìˆ˜
        function removeDrop(index) {
            if (raindrops[index]) {
                raindrops[index].element.remove(); // HTML ì‚­ì œ
                raindrops.splice(index, 1); // ë°°ì—´ ì‚­ì œ
            }
        }

        // ìƒëª… í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateLifeUI() {
            let hearts = "";
            for(let i=0; i<lives; i++) hearts += "â¤";
            lifeEl.innerText = hearts;
            lifeEl.style.color = lives === 1 ? "red" : "pink";
        }

        // ê²Œì„ ì¢…ë£Œ ì²˜ë¦¬
        function gameOver() {
            isPlaying = false;
            clearInterval(rainInterval);
            clearInterval(moveInterval);
            
            msgTitle.innerText = `ê²Œì„ ì˜¤ë²„! ìµœì¢… ì ìˆ˜: ${score}ì `;
            overlay.style.display = 'flex'; // ë‹¤ì‹œ ì‹œì‘ í™”ë©´ í‘œì‹œ
        }
    </script>
</body>
</html>